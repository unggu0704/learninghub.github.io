# Azure Functions

### Architect

![스크린샷 2024-10-14 오후 2.25.49.png](az/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.25.49.png)

### Serverless?

- 서버의 완정한 추상화
- event-driven 확장성
- 사용한만큼의 요금

**Serverless vs.  PaaS**

- 서버관리 필요성 없고, 코드 위주로 작성 하는것은 비슷
- 개발환경 제어력은 PaaS > Serverless
    - PaaS는 스케일링 구성이 필수적, Serverless는 스케일링 조차 자동으로 해줌

**장점**

- 비즈니스 문제에 집중
- 출시기간의 단축, 비용 절감(호출시에만 지출)
- 손쉬운 프로토타이핑, 마이크로서비스

**Serverless의 중심 FaaS**

- 단일 책임
- 짧은 수명
- 상태 비 저장
- Event driven & scalable

### Azure Functions 개요

- 데이터 처리, SI, API, 마이크로서비스 빌드시 유용한 솔루션
- 주문 처리 및 파일 유지 관리등 모든 작업에 Functions를 사용
- 코드를 실행하는 트리거와 입출력 데이터 코딩 바인딩 하는 바인딩 기능 지원

### Azure Functions 정의 및 특징

- 통합 프로그래밍 모델
- 향상된 개발 모델
- 유연한 호스팅 옵션

### Azure Functions의 기능

- 다양한 언어의 지원 → 언어간의 이종 호환은 불가함
- 호스팅 옵션 → 코드 실행 시간에 대해서만 청구
- 라이브러리 사용가능
- Stateful 처리 가능
- Azure 포탈 뿐만 아닌 주류 개발 도구 사용 가능
- 다른 SaaS 솔루션과 간편하게 통합 가능

### Azure Functions의 동작

![스크린샷 2024-10-14 오후 2.57.58.png](Azure%20Functions%2011fb01a7807e801092a1f47a615366ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.57.58.png)

1. Trigger를 통해 객체를 던짐
2. 코드를 실행하고 필요한 경우 Input Binding 등을 통해 객체를 만듬
3. 처리가 끝나고 Output Binding을 통해 산출물 생성

### Azure Functions의 제약 사항

- 함수는 최대 10분 이상 실행이 불가능함
- 컴퓨팅 자원또한 1.5GB까지의 램과 하나의 CPU 파워만 사용가능
- 실행 주기에 따른 제약을 검

### Azure Functions을 통한 Azure 서비스 통합

![스크린샷 2024-10-14 오후 3.00.21.png](Azure%20Functions%2011fb01a7807e801092a1f47a615366ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.00.21.png)

## Azure Functions 호스팅

### 호스팅 계획

- **사용 계획**
    - 자동 크기 조절
    - 수요에 따른 인스턴스 갯수 조절
- Premium Functions계획
    - 유후상태로 대기 → 즉시 실행
    - VNet 이용 가능
- App Service 계획
    - 장기 실행이 가능
    - 유후 상태로 있다가 *HTTP* 요청에만 활성화가 됨

> *모든 요금제에서 함수 앱 실행하기 위해서는 일반 Azure 저장소 계정이 필요*
> 

## Azure Functions 크기 조정

> Azure Functions은 *크기 조절 컨트롤러* 를 통해 모니터링 및 확장과 축소를 결정한다.
> 

### 크기 조정

**최대 인스턴스 수** : 단일 function은 200까지 확장 가능, 동시 실행에는제한 없음

**새 인스턴스 수** : HTTP 트리거의 경우 1초에 한개, 나머지는 30초에 한개 

## Azure Functions 개발 과정

![스크린샷 2024-10-14 오후 3.36.28.png](Azure%20Functions%2011fb01a7807e801092a1f47a615366ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.36.28.png)

**중요한 요소 두가지**

- 코드 : 프로그래밍 언어
- 구성 : *function.json*
    - 트리거, 바인딩 및 기타 구성 설정을 정의

**모든 함수에는 하나의 트리거만 존재!!**

- Function을 만들기 위해서는 일반적인 개발 도구를 사용해 함수를 만들고 테스트 할 수 있다.

### Function 앱

함수가 실행되는 컨텍스트 

- 함수의 배포 단위 (관리 단위)
- 하나 이상의 개별 함수로 구성되어 모든 기능은 동일한 정책으로 통일 되어 있음

 

## 트리거 및 바인딩 만들기

- 트리거 → 함수가 실행되는 원인 (함수와 트리거는 일대일 대응)
- 바인딩 → 다른 리소스를 함수에 연결하는 것 (입력 바인딩, 출력 바인딩)
    - 하드코딩 엑세를 방지

### 바인딩 방향

- 트리거에는 방향 속성이 존재
    - 트리거의 경우 `in`
    - 입력 출력 바인딩의 경우 `in` 과 `out`

### 트리거 바인딩 예제

![스크린샷 2024-10-14 오후 3.49.34.png](Azure%20Functions%2011fb01a7807e801092a1f47a615366ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.49.34.png)

- Azure Queue Storage 메세지 표시 → Azure Table Storage에 새 행을 작성하는 예제