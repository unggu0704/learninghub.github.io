# Azure Event & Azure Queue

# Azure Event

### 아키텍쳐

![스크린샷 2024-10-16 오후 3.32.59.png](Azure%20Event%20&%20Azure%20Queue%20121b01a7807e80f1a5efd76b55a69688/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-16_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.32.59.png)

**이벤트 :** 시스템에서 발생하는 정보

**이벤트 원본** : 이벤트의 발생 장소

**토픽** : 원본 → 이벤트의 엔드 포인트

**이벤트 구독** : 토픽이 어떤 이벤트를 원하는지? (필터링 적용 가능)

**이벤트 처리기** : 이벤트가 전송되는 곳 

### 이벤트 스키마

![스크린샷 2024-10-16 오후 3.36.15.png](Azure%20Event%20&%20Azure%20Queue%20121b01a7807e80f1a5efd76b55a69688/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-16_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.36.15.png)

## Azure Event Grid

![스크린샷 2024-10-16 오후 3.33.58.png](Azure%20Event%20&%20Azure%20Queue%20121b01a7807e80f1a5efd76b55a69688/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-16_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.33.58.png)

- 이벤트 백플레인
- Azure에서 제공되는 이벤트를 모두 지원
- 필터 사용가능

### 이벤트 배달 내구성

- 다시 시도 일정 : 이벤트 못보내면 다시 보낼지?
- 재시도 정책 : 이벤트 구독 생성시 이벤트최대 시도 및 TTL 설정
- 지연 배달 : 이벤트가 정상적으로 배달되지 않을때 배달 시도 자체를 지연
- 배달 불가 : 배달을 보내지 못할때 이벤트를 스토리지로 전송

### 이벤트 송/수신

- **Azure Function & Azure Logic App을 통해 Event 송신**
- **웹 후크를 사용해 이벤트 수신**

### 이벤트 필터링

- 유형 필터링
    - 특정 유형만 엔드포인트로 전송
- 제목 필터링
    - 제목으로 간단하게 시작 끝값 전송
- 고급 필터링
    - 연산자 등 사용

# Azure Message Queue

![스크린샷 2024-10-16 오후 4.22.29.png](Azure%20Event%20&%20Azure%20Queue%20121b01a7807e80f1a5efd76b55a69688/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-16_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.22.29.png)

## Azure Service Bus

![스크린샷 2024-10-16 오후 4.25.07.png](Azure%20Event%20&%20Azure%20Queue%20121b01a7807e80f1a5efd76b55a69688/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-10-16_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.25.07.png)

### Service Bus Queue vs. Storage Queue

- 큐 하나에 80GB 넘는 메세지 저장시 → Storage
- FIFO → Service Bus
- 자동 중복검색, 병렬 장기 스트림 처리, 여러 송신 → Service Bus
- 큐의 메세지 처리 추적, 트랜잭션 로그 → Storage

**큐**

- FIFO 자료구조

**수신모드**

- Service Bus가 메세지 수신 모드
    - 수신 및 삭제
    - 보기 잠금

**토픽 및 구독**

- 일 대 다 통신 형태 제공

**규칙 및 적용**

- 원하는 속성의 메세지 찾으면 해당 작업에 대한 특정 수행 처리
- 필터등을 통해 가상 구독 큐 복사 작업 가능

## Azure Queue Storage

- 대량의 메세지 저장
- 큐의 최대 크기는 64kb 대신 큐는 80개까지 소유 가능
- 비용 저렴함
- URL, 스토리지 등등 담김