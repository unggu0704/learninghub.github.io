# Azure 가상머신

> *온프레미스 환경에서 누리던 제어력을 제공하기 위한 가상 머신 서비스*
> 

### 가상머신을 만들때

- Azure 가상머신 이름은 기본적으로호스트 이름으로도 사용
    - 호스트 이름은 변경할 수 있찌만 가상 머신 이름은 변경이 어렵다
- 실제 사용자들의 위치와 가까운 리전에서 서비스를 제공해야 만족성이 높다
- 나라마다 가격과 규정, 세금의 차이가 있을 수 있다
- 가상머신의 비용은 컴퓨팅 비용과 스토리지 비용으로 나뉜다.

### 가상머신 유형

**Azure 가상 머신**

- 일반적으로 Azure에서 호스팅하는 일반적인 가상머신

**사전 설정 구성이 포함된 Azure 가상머신**

- 워크로드 기반으로 사전설정이 포함된 가상머신
- 가상머신의 빠른 사용이 가능

**Azure Arc 가상 머신**

- 리소스 브리지를 사용해 온프레미스나 다른 클라우드 환경을 Azure Arc에 추가 후 Azure Arc에서 관리하는 가상 머신

### 운영체제

- 윈도우 - 유료 라이선스
    - 단 윈도우 업그레이드는 제공하지 않는다.
- CentOS - 무료 라이선스
- 우분투 - 무료 라이선스
    - Azure 보증 리눅스 운영체제 같은 경우 업그레이드가 가능 하기도 하다.

### 네트워킹 요소

- 가상머신의 통신에 있어 필수적인 요소
- 가상머신을 만들 때 함께 배포되는 4가지 요소
    - **공용 IP 주소**
        - Azure 가상머신 ↔ 인터넷
    - **네트워크 보안 그룹**
        - 통신의 필터링
    - **네트워크 인터페이스**
        - 일반적인 컴퓨터의 랜카드 역할
    - **가상 네트워크**
        - 가상머신 만들때 자동으로 지정

### 가상머신 크기

- 가상머신 크기를 결정할 때에[는 워크로드 유형을 고려
- 워크로드 유형에 따라 형식을 나누고 CPU 성능, 메모리량 등을 고려해 VM 만들기
- 자세한 워크로드 형식은 Azure 블로그 참조

### 가상 디스크 종류 3가지

Azure에서 제공하는 스토리지 

- **운영체제 디스크**
    - 운영체제 이미지가 설치된 디스크
- **임시 디스크**
    - 단기 저장소
    - 스왑 파일, tempdb 저장
    - 손실 가능성 있음
- **데이터 디스크**
    - 사용자가 유지해야할때 사용되는 저장소
    - 웹사이트 소스, 데이터베이스 파일

### 가상 디스크의 특징

- 모든 디스크의 고정 형식은 `*.vhd` 를 가진다.
- 디스크 캐싱 기능
    - 읽기/쓰기 캐시
    - 읽기 전용 캐시
    - 캐시 없음

---

## Azure 가상 머신 만들기

### 윈도우 11 VM 만들기

1. Azure Portal 검색창에 → *Windows 11* 검색  후 만들기 버튼 클릭 
2. **가상머신 만들기** 속성 창 입력
    1. 가용성 옵션 : 필요 없음 
3. 암호 설정
4. OS 디스크 유형 : 프리미엄 SSD
5. **확장 설치** 버튼 클릭 후 *Microsoft Antimalware*을 클릭 
6. 검토 + 만들기 
7. 설정 → 속성에서 원시 RDP를 다운로드 
    1. *맥북에서는 RDP 전용 리더 앱 별도 필요* 

### 윈도우 서버 VM 만들고 연결하기

1. 리소스 만들기 → Windows Server → 2022 DataCenter 버전 선택 
2. 윈도우 만드는 것처럼 만들기
3. 디스크 설정 → 새 디스크 만들기 → 크기 부분을 128GIB로 변경 
4. 모니터링 → 부트 진단 → 사용안함
5. 검토 + 만들기 
6. RDP 실행 후 **Windows PowserShell ISE** 실행 
    1. `Install-WindowsFeature -Name Web-Server -IncludeManagementTools` - 웹 서버 역할 설치
    2. `Set-Content -Path "C:\inetpub\wwwroot\Default.html " -Value "Running jarvis from $($env:COMPUTERNAME) !"` - Default.html 만들기 
    
    →  **`Default.html` 은 인지  하지 못하고 403 에러 발생  `index.html` 로 하니깐 되었다.**
    
    > *이걸 하는데 있어 충분한 클라우드 컴퓨팅 파워가 필요하다 → 기본 무료 사양으로는 안됨*
    > 
    
    > *이걸 하고 공용 IP 주소로 외부에서 접속이 가능해야하는데.. 되지 않음*
    > 

---

### Issue - Web Server를 접속할 수 없음

**World Wide Web Publishing Service"의 약자로, IIS(Internet Information Services)의 핵심 서비스의 가동 상태를 점검하는 명령어**

```jsx
Get-Service -Name W3SVC
```

**IIS의 재설치를 위해 제거하는 명령어**

```jsx
Uninstall-WindowsFeature -Name Web-Server -Remove
```

- 이거 하면 `C:\Windows\WinSxS` 의 이미지 파일까지 지워진다.
- 재설치행…

재설치 하니깐 iis는 되었다. 

하지만 `Default.html` 은 인지  하지 못하고 `index.html` 로 하니깐 되었다.

---

### 리눅스 VM 만들기

- 리소스 검색하기를 통해 우분트 선택
- 앞선 과정과 대부분 비슷하지만, **공용 인바운드 포트 : 없음** 으로 외부와 접속을 허용하게 하지 않는다.
- 저장 장치는 표준 SSD, 네트워크는 기존에 만들어논 네트워크를 사용
- 태그 설정 후 만들기
- 프라이빗 키 다운로드해서 저장

- 첫번째 실습에서 만든 Window11 실행
- `mkdir .ssh` 을 통해 디렉토리 생성
- 그 안에 프라이빗키(.pem)을 붙여넣기
- `ssh -i .ssh\vmjarvisbe_key.pem [tony@](mailto:tony@172.16.1.7)<BACKEND_PRIVATE_KEY>`

### 디스크 만들기

- 리눅스 VM에 디스크 추가
    - *jvdeDataDisk1* , 프리미엄 SSD, 256GiB
- 윈도우에서 `sudo dmesg | grep SCSI` 입력 해 확인
    - sda는 OS 디스크
    - sdb는 임시 디스크
    - sdc는 데이터 디스크
- 새로운 디스크에 대한 파티션 작업 실행
    - 명령어는 인터넷 참조…